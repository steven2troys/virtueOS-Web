<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Napkin | virtueOS Archive</title>

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* ==================== Dark Theme (Default) ==================== */
        :root {
            /* Warm stone palette */
            --bg-deep: #0f0e0d;
            --bg-primary: #1a1917;
            --bg-secondary: #242220;
            --bg-tertiary: #2e2b28;
            --bg-elevated: #383432;

            /* Text hierarchy */
            --text-primary: #e8e4df;
            --text-secondary: #b5aea5;
            --text-muted: #7a746b;
            --text-faint: #524d46;

            /* Accent - aged gold/copper */
            --accent: #c9a227;
            --accent-dim: #8b7355;
            --accent-glow: rgba(201, 162, 39, 0.15);

            /* Artifact colors */
            --artifact-bg: #f5f1e8;
            --artifact-ink: #2c2825;
            --artifact-stain: rgba(139, 90, 43, 0.2);

            /* Borders */
            --border: #3a3632;
            --border-strong: #4a4540;

            /* Layout */
            --sidebar-width: 260px;
            --notes-width: 380px;

            /* Typography */
            --font-serif: 'Crimson Pro', Georgia, serif;
            --font-sans: 'DM Sans', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

            /* Theme toggle icon */
            --theme-icon: "☀";
        }

        /* ==================== Light Theme ==================== */
        [data-theme="light"] {
            /* Warm parchment palette */
            --bg-deep: #e8e4dc;
            --bg-primary: #f5f2eb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0ede6;
            --bg-elevated: #e5e1d8;

            /* Text hierarchy */
            --text-primary: #1a1917;
            --text-secondary: #4a4743;
            --text-muted: #7a756c;
            --text-faint: #a9a49a;

            /* Accent - deeper gold for contrast */
            --accent: #9a7b1c;
            --accent-dim: #6b5a3d;
            --accent-glow: rgba(154, 123, 28, 0.12);

            /* Borders */
            --border: #d4d0c6;
            --border-strong: #c4c0b6;

            /* Theme toggle icon */
            --theme-icon: "☾";
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-deep);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
        }

        /* ==================== Layout ==================== */
        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .panels-wrapper {
            display: flex;
            flex: 1;
            min-width: 0;
            position: relative;
        }

        /* ==================== Left Sidebar ==================== */
        .sidebar {
            background: var(--bg-primary);
            border-right: 1px solid var(--border);
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            height: 100vh;
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 32px 24px 24px;
            border-bottom: 1px solid var(--border);
        }

        .archive-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-strong);
            border-radius: 2px;
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .archive-badge::before {
            content: "";
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
        }

        .archive-title {
            font-family: var(--font-serif);
            font-size: 22px;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .archive-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Table of Contents */
        .toc-section {
            flex: 1;
            overflow-y: auto;
            padding: 20px 16px;
        }

        .toc-label {
            font-family: var(--font-mono);
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-faint);
            padding: 0 8px;
            margin-bottom: 12px;
        }

        .toc {
            list-style: none;
        }

        .toc-item {
            margin-bottom: 2px;
        }

        .toc-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.15s ease;
            position: relative;
        }

        .toc-link:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .toc-link.active {
            background: var(--accent-glow);
            color: var(--text-primary);
        }

        .toc-link.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 2px;
            height: 24px;
            background: var(--accent);
            border-radius: 1px;
        }

        .toc-number {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-faint);
            min-width: 28px;
        }

        .toc-title {
            font-size: 13px;
            font-weight: 500;
        }

        .toc-type {
            margin-left: auto;
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-faint);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toc-link.interlude {
            opacity: 0.7;
        }

        .toc-link.interlude .toc-title {
            font-style: italic;
            font-weight: 400;
        }

        /* Navigation */
        .nav-section {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            flex: 1;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            transition: all 0.15s ease;
        }

        .nav-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-strong);
            color: var(--text-primary);
        }

        /* ==================== Main Artifact Panel ==================== */
        .artifact-panel {
            flex: 1;
            min-width: 400px;
            height: 100vh;
            overflow-y: auto;
            background: var(--bg-primary);
            position: relative;
        }

        .artifact-container {
            max-width: 680px;
            margin: 0 auto;
            padding: 48px 40px 80px;
        }

        /* Catalog Header */
        .catalog-header {
            margin-bottom: 40px;
        }

        .catalog-tag {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .catalog-number {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--accent);
            background: var(--accent-glow);
            padding: 4px 10px;
            border-radius: 2px;
            letter-spacing: 1px;
        }

        .catalog-date {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-muted);
            letter-spacing: 0.5px;
        }

        .artifact-title-block {
            border-left: 3px solid var(--accent);
            padding-left: 20px;
        }

        .artifact-chapter {
            font-family: var(--font-mono);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .artifact-title {
            font-family: var(--font-serif);
            font-size: 36px;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }

        .artifact-type {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Specimen Card */
        .specimen-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px 24px;
            margin-bottom: 32px;
            position: relative;
        }

        .specimen-card::before {
            content: "ARTIFACT DATA";
            position: absolute;
            top: -8px;
            left: 16px;
            font-family: var(--font-mono);
            font-size: 9px;
            letter-spacing: 1.5px;
            color: var(--text-faint);
            background: var(--bg-secondary);
            padding: 0 8px;
        }

        .specimen-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 24px;
        }

        .specimen-label {
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-faint);
        }

        .specimen-value {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Artifact Display */
        .artifact-display {
            background: var(--bg-deep);
            border-radius: 8px;
            padding: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .artifact-display::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse at 30% 20%, rgba(201, 162, 39, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(139, 115, 85, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .napkin-image {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            border-radius: 4px;
            box-shadow:
                0 8px 32px rgba(0,0,0,0.4),
                0 2px 8px rgba(0,0,0,0.3);
            transform: rotate(-0.5deg);
            position: relative;
            z-index: 1;
        }

        /* Transcription Section */
        .transcription-section {
            margin-top: 40px;
            padding-top: 32px;
            border-top: 1px solid var(--border);
        }

        .transcription-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .transcription-label {
            font-family: var(--font-mono);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-faint);
        }

        .transcription-note {
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        .transcription-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 24px;
        }

        .transcription-diagram {
            font-family: var(--font-mono);
            font-size: 12px;
            line-height: 1.5;
            color: var(--text-secondary);
            white-space: pre;
            margin-bottom: 16px;
            opacity: 0.7;
        }

        .transcription-notes {
            font-family: var(--font-serif);
            font-style: italic;
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.7;
            opacity: 0.7;
        }

        .transcription-notes p {
            margin-bottom: 4px;
        }

        /* ==================== Splitter ==================== */
        .splitter {
            width: 1px;
            background: var(--border);
            cursor: col-resize;
            position: relative;
            flex-shrink: 0;
            transition: background 0.15s;
        }

        .splitter:hover,
        .splitter.dragging {
            background: var(--accent);
            width: 2px;
        }

        /* ==================== Notes Panel ==================== */
        .notes-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            width: var(--notes-width);
            min-width: 280px;
            max-width: 500px;
            height: 100vh;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .notes-container {
            padding: 40px 32px;
        }

        .notes-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .notes-avatar {
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-strong);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-serif);
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
        }

        .notes-meta {
            flex: 1;
        }

        .notes-author {
            font-family: var(--font-sans);
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .notes-timestamp {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-faint);
            letter-spacing: 0.5px;
        }

        .notes-content {
            font-family: var(--font-serif);
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .notes-content p {
            margin-bottom: 20px;
        }

        .notes-content p:last-child {
            margin-bottom: 0;
        }

        .notes-content .emphasis {
            color: var(--text-primary);
            font-weight: 500;
        }

        .notes-content .aside {
            color: var(--text-muted);
            font-size: 14px;
        }

        .notes-content .pullquote {
            font-size: 17px;
            font-weight: 500;
            color: var(--text-primary);
            border-left: 2px solid var(--accent);
            padding-left: 16px;
            margin: 28px 0;
        }

        /* ==================== Scrollbar ==================== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--bg-elevated);
        }

        /* ==================== Responsive ==================== */
        @media (max-width: 1200px) {
            :root {
                --sidebar-width: 220px;
                --notes-width: 320px;
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }

            .splitter {
                display: none;
            }

            .panels-wrapper {
                flex-direction: column;
            }

            .artifact-panel {
                min-width: unset;
                height: auto;
            }

            .notes-panel {
                width: 100%;
                max-width: none;
                min-width: unset;
                height: auto;
                border-left: none;
                border-top: 1px solid var(--border);
            }
        }

        /* Prevent text selection during drag */
        body.dragging {
            user-select: none;
            cursor: col-resize;
        }

        /* ==================== Theme Toggle ==================== */
        .theme-toggle {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-strong);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--text-muted);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            background: var(--bg-elevated);
            color: var(--accent);
            border-color: var(--accent);
        }

        .theme-toggle::after {
            content: var(--theme-icon);
        }

        /* Smooth theme transition */
        html {
            transition: background-color 0.3s ease;
        }

        html.theme-transitioning,
        html.theme-transitioning *,
        html.theme-transitioning *::before,
        html.theme-transitioning *::after {
            transition: background-color 0.3s ease,
                        color 0.3s ease,
                        border-color 0.3s ease,
                        box-shadow 0.3s ease !important;
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" title="Toggle light/dark mode" aria-label="Toggle theme"></button>

    <div class="container">
        <!-- Left Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="archive-badge">Classified Archive</div>
                <h1 class="archive-title">Marble Porch</h1>
                <p class="archive-subtitle">Project virtueOS Documentation</p>
            </div>

            <div class="toc-section">
                <div class="toc-label">Contents</div>
                <ul class="toc">
                    <li class="toc-item">
                        <a href="../01-post-mortem/index.html" class="toc-link">
                            <span class="toc-number">01</span>
                            <span class="toc-title">Post-Mortem</span>
                            <span class="toc-type">doc</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="../02-napkin/index.html" class="toc-link active">
                            <span class="toc-number">02</span>
                            <span class="toc-title">Napkin</span>
                            <span class="toc-type">artifact</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="../../interludes/01-before-the-napkin/index.html" class="toc-link interlude">
                            <span class="toc-number">I-1</span>
                            <span class="toc-title">Before the Napkin</span>
                            <span class="toc-type">game</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="../03-first-believer/index.html" class="toc-link">
                            <span class="toc-number">03</span>
                            <span class="toc-title">First Believer</span>
                            <span class="toc-type">msg</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="../04-pitch-deck/index.html" class="toc-link">
                            <span class="toc-number">04</span>
                            <span class="toc-title">Pitch Deck</span>
                            <span class="toc-type">slides</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">05</span>
                            <span class="toc-title">Skeptic's Report</span>
                            <span class="toc-type">doc</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">06</span>
                            <span class="toc-title">Money Meeting</span>
                            <span class="toc-type">notes</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">07</span>
                            <span class="toc-title">Genius Arrives</span>
                            <span class="toc-type">email</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link interlude">
                            <span class="toc-number">I-2</span>
                            <span class="toc-title">The New Player</span>
                            <span class="toc-type">game</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">08</span>
                            <span class="toc-title">The Advisors</span>
                            <span class="toc-type">spec</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">09</span>
                            <span class="toc-title">Architecture</span>
                            <span class="toc-type">diagram</span>
                        </a>
                    </li>
                    <li class="toc-item">
                        <a href="#" class="toc-link">
                            <span class="toc-number">10</span>
                            <span class="toc-title">First Test</span>
                            <span class="toc-type">log</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <a href="../01-post-mortem/index.html" class="nav-btn">← Previous</a>
                <a href="../03-first-believer/index.html" class="nav-btn">Next →</a>
            </div>
        </nav>

        <!-- Panels Wrapper -->
        <div class="panels-wrapper">
            <!-- Main Artifact Panel -->
            <main class="artifact-panel">
                <div class="artifact-container">
                    <!-- Catalog Header -->
                    <header class="catalog-header">
                        <div class="catalog-tag">
                            <span class="catalog-number">MP-2026-001</span>
                            <span class="catalog-date">October 2026</span>
                        </div>

                        <div class="artifact-title-block">
                            <div class="artifact-chapter">Chapter Two</div>
                            <h1 class="artifact-title">Napkin</h1>
                            <p class="artifact-type">Physical artifact — bar napkin with diagram</p>
                        </div>
                    </header>

                    <!-- Specimen Card -->
                    <div class="specimen-card">
                        <div class="specimen-grid">
                            <span class="specimen-label">Object</span>
                            <span class="specimen-value">Cocktail napkin, standard bar size</span>

                            <span class="specimen-label">Date</span>
                            <span class="specimen-value">October 2026 (estimated from context)</span>

                            <span class="specimen-label">Location</span>
                            <span class="specimen-value">Alan Goodenough's desk drawer, April 2028</span>

                            <span class="specimen-label">Condition</span>
                            <span class="specimen-value">Multiple stains (beer, coffee), creased from folding</span>
                        </div>
                    </div>

                    <!-- Artifact Image -->
                    <div class="artifact-display">
                        <img
                            src="../../images/drunk_stoic_napkin_flowchart.png"
                            alt="The original napkin sketch showing the virtueOS concept - a flowchart drawn in blue ink on a stained bar napkin"
                            class="napkin-image"
                        >
                    </div>

                    <!-- Transcription -->
                    <section class="transcription-section">
                        <div class="transcription-header">
                            <span class="transcription-label">Transcription</span>
                            <span class="transcription-note">Reverse side — partial, liquid damaged</span>
                        </div>

                        <div class="transcription-content">
                            <div class="transcription-diagram">    USER
      |
      ?-----> advisor 1
      ?-----> advisor 2
      ?-----> advisor 3

      "3 advisors = 3 stoics?"</div>
                            <div class="transcription-notes">
                                <p>like angel/devil but smarter</p>
                                <p>both angels</p>
                                <p>no — PHILOSOPHERS</p>
                            </div>
                        </div>
                    </section>
                </div>
            </main>

            <!-- Splitter -->
            <div class="splitter" id="splitter"></div>

            <!-- Notes Panel -->
            <aside class="notes-panel" id="notesPanel">
                <div class="notes-container">
                    <header class="notes-header">
                        <div class="notes-avatar">AG</div>
                        <div class="notes-meta">
                            <div class="notes-author">Alan's Notes</div>
                            <div class="notes-timestamp">Added to archive: April 2028</div>
                        </div>
                    </header>

                    <div class="notes-content">
                        <p class="pullquote">This is the napkin. THE napkin.</p>

                        <p>I was three beers in. Maybe four. I'd had a bad day at work. Something about a deployment that went sideways and a manager who blamed the wrong person. I don't actually remember the specifics anymore. What I remember is sitting at O'Malley's on Fourth Street, the one that closed six months later, drawing on a napkin because my phone was dead and I didn't want to go home yet.</p>

                        <p>The diagram looks insane. I know it looks insane. But I was trying to draw what it felt like when Marcus Aurelius made sense to me. That moment when you're angry about something and you read "You have power over your mind, not outside events" and suddenly the anger shrinks. What if technology could do that? What if something could watch your life and whisper the right Stoic principle at the right moment?</p>

                        <p class="emphasis">Not a meditation app. Not breathing exercises. Something that actually understood what was happening and told you the truth about it.</p>

                        <p>I drew "what would marcus do?" in the corner and thought I was being clever. I was drunk and sad and sitting alone at a bar, sketching an AR system I had no idea how to build. I probably should have called someone. Gone to a meeting. Done anything other than what I did, which was fold this napkin into my pocket and walk home in the rain thinking I'd finally had a real idea.</p>

                        <p class="aside">The note on the bottom says "call danielle?" That's DM. I'd been avoiding calling her for two weeks because I thought she'd tell me to get a real job. She'd been running her D&D campaign every Thursday and I'd been making excuses not to show up. I was in a bad place. The napkin felt like evidence that I wasn't completely useless.</p>

                        <p>I didn't call her that night. But I showed her the napkin two days later, over coffee, expecting her to laugh at me. She didn't laugh. She asked questions I couldn't answer. When I said "I don't know" for the sixth time, she took the napkin from my hands and said <span class="emphasis">"Then we figure it out."</span></p>

                        <p>That was the moment, really. Not the napkin. The moment someone looked at my stupid drunk sketch and saw something worth building.</p>

                        <p>I keep it because it reminds me that I didn't create virtueOS. Not really. I drew some boxes and arrows on a bar napkin. Everything that came after — the actual system, the architecture, the AI advisors, TenX's code, Val's security framework — all of it, that was other people taking seriously what I could only imagine badly.</p>

                        <p class="emphasis">I didn't know this was the most important thing I'd ever draw.</p>

                        <p class="aside">I still don't know what to make of that.</p>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ==================== Theme Toggle ====================
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check for saved theme preference or default to dark
        const savedTheme = localStorage.getItem('virtueOS-theme') || 'dark';
        if (savedTheme === 'light') {
            html.setAttribute('data-theme', 'light');
        }

        themeToggle.addEventListener('click', () => {
            // Add transition class
            html.classList.add('theme-transitioning');

            // Toggle theme
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            if (newTheme === 'light') {
                html.setAttribute('data-theme', 'light');
            } else {
                html.removeAttribute('data-theme');
            }

            // Save preference
            localStorage.setItem('virtueOS-theme', newTheme);

            // Remove transition class after animation
            setTimeout(() => {
                html.classList.remove('theme-transitioning');
            }, 300);
        });

        // ==================== Splitter Drag ====================
        const splitter = document.getElementById('splitter');
        const notesPanel = document.getElementById('notesPanel');
        let isDragging = false;
        let startX = 0;
        let startWidth = 0;

        splitter.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startWidth = notesPanel.offsetWidth;
            splitter.classList.add('dragging');
            document.body.classList.add('dragging');
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const delta = startX - e.clientX;
            const newWidth = Math.min(500, Math.max(280, startWidth + delta));
            notesPanel.style.width = newWidth + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                splitter.classList.remove('dragging');
                document.body.classList.remove('dragging');
            }
        });
    </script>
</body>
</html>
